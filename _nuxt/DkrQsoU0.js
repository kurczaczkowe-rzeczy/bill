import ce from"./wHCLB61C.js";import{_ as pe}from"./HW42BR3s.js";import{e as ge,m as me,f as R,n as J,p as K,r as y,q as fe,c as l,a as o,g as w,b as S,s as ye,w as we,j as n,h as I,i as U,v as G,d as H,F as v,l as h,x as ve,y as z,t as c,o as a,z as N}from"./f90SPW_5.js";import{S as he,P as _e,C as be,U as L,g as ke}from"./B-fOdfTW.js";import{u as Q,k as $}from"./nCoCZphG.js";const xe={class:"card flex justify-center flex-col max-w-xl m-auto"},Ce={class:"card-body list bg-base-100 rounded-box shadow-md w-full"},Se={class:"px-2 inline-flex flex-row gap-2"},Le={class:"list-row-separator"},$e={class:"btn btn-ghost btn-square"},Ae={class:"relative col-span-2"},De=["aria-expanded","aria-activedescendant"],Te={key:0,id:"suggestions-list",class:"border-1 w-full absolute top-full left-0 right-0 mt-1 z-20 menu bg-base-100 rounded-box shadow-lg max-h-64 overflow-auto p-2",role:"listbox"},Be={key:0,class:"disabled",role:"presentation"},Ee=["id","aria-selected","onClick","onMouseenter"],Ie={class:"badge badge-ghost badge-sm"},Ue={key:2,class:"disabled",role:"presentation"},ze=["value"],Ne={class:"relative col-span-3"},je={key:0,class:"flex items-center gap-2"},qe={key:1,class:"opacity-60"},Me={key:0,class:"border-1 w-full absolute top-full left-0 right-0 mt-1 z-20 bg-base-100 rounded-box shadow-lg max-h-64 overflow-auto p-2",role:"listbox"},Ve={key:0,class:"disabled",role:"presentation"},Oe=["aria-selected","onClick"],Fe={class:"inline-flex items-center gap-2"},Pe=["onClick"],Re={class:"list-col-grow"},Je={key:1,class:"list-row"},Ke={key:1,class:"list-row"},Ge={key:0,class:"flex flex-col gap-1"},He={class:"text-error"},tt=ge({__name:"[id]",async setup(Qe){let p,k;const x=me(),A=new he,X=new _e,Y=new be,Z=L.values(),{data:j,error:W,refresh:q,status:ee}=([p,k]=R(async()=>Q(`shoppingListDetails:${x.params.id}`,async()=>{if(isNaN(Number(x.params.id)))return[];const e=await A.getShoppingListAsync(x.params.id);if("error"in e)throw new Error(e);if(!("result"in e))throw new Error("Unsupported response type: "+e.constructor.name);return $(e.result)})),p=await p,k(),p),M=J({name:""}),r=J({name:"",quantity:1,unit:L.GRAM,categoryId:1}),V=K(()=>[W.value,oe.value].filter(Boolean)),i=y([]),m=y(!1),C=y(!1),u=y(-1);let D=null;function T(){i.value.length>0&&(m.value=!0)}function f(){m.value=!1,u.value=-1}function O(e){r.name=e.name,r.unit=L.valueOf(e.unit),f()}async function te(e){if(!e||e.trim().length<2){i.value=[],f();return}C.value=!0;try{const s=await X.getProductSuggestionAsync(r.name);if("error"in s){i.value=[],f();return}if(!("result"in s)){i.value=[],f();return}const g=$(s.result);i.value=g||[],T()}finally{C.value=!1}}fe(()=>r.name,e=>{D&&clearTimeout(D),D=setTimeout(()=>{te(e)},250)});function se(e){if(!m.value&&(e.key==="ArrowDown"||e.key==="ArrowUp")){T();return}m.value&&(e.key==="ArrowDown"?(e.preventDefault(),u.value=i.value.length===0?-1:(u.value+1)%i.value.length):e.key==="ArrowUp"?(e.preventDefault(),u.value=i.value.length===0?-1:(u.value-1+i.value.length)%i.value.length):e.key==="Enter"?u.value>=0&&u.value<i.value.length&&(e.preventDefault(),O(i.value[u.value])):e.key==="Escape"&&f())}function ne(){setTimeout(()=>f(),100)}const{data:B,error:oe,status:ae}=([p,k]=R(async()=>Q("categories",async()=>{const e=await Y.getCategoriesAsync();if("error"in e)throw new Error(e);if(!("result"in e))throw new Error("Unsupported response type: "+e.constructor.name);return $(e.result)})),p=await p,k(),p),_=y(null),b=y(!1),E=e=>{if(!e)return"";const s=e.split(" ");return s.length>1?s.slice(0,2).map(g=>g[0]).join("").toUpperCase():e.slice(0,2).toUpperCase()},le=e=>{_.value=e,b.value=!1,r.categoryId=e.id},F=K(()=>j.value&&B.value?$(ke(j.value,B.value)):[]);async function re(e){A.toggleProductInCartAsync(e).then(s=>{"error"in s&&console.error(s.error),q()})}async function ie(e){if(r.name.trim()===""){M.name="Nazwa powinna być wypełniona";return}A.addToShoppingListAsync(x.params.id,L.valueOf(r.unit.name),r.quantity,r.name,r.categoryId).then(()=>{e.currentTarget?.reset(),ue(),q()})}function ue(){r.name="",r.quantity=1,M.name=""}return(e,s)=>{const g=ce,de=pe;return a(),l("div",xe,[o("ul",Ce,[o("li",Se,[S(de,{to:"/"},{default:we(()=>[S(g,{name:"streamline-freehand:keyboard-arrow-return"})]),_:1}),n(ee)==="pending"?(a(),ye(g,{key:0,class:"animate-spin text-info",name:"streamline-freehand:loading-star-1"})):w("",!0)]),o("li",Le,[o("form",{class:"grid grid-cols-[80px_minmax(0,_auto)_45px]",onSubmit:I(ie,["prevent"])},[o("button",$e,[S(g,{name:"streamline-freehand:add-sign-bold"})]),o("div",Ae,[U(o("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>n(r).name=t),class:"input input-ghost w-full",placeholder:"Nazwa produktu",required:"",type:"text",autocomplete:"off",role:"combobox","aria-autocomplete":"list","aria-expanded":n(m),"aria-controls":"suggestions-list","aria-activedescendant":n(u)>=0?`suggestion-${n(u)}`:null,onFocus:s[1]||(s[1]=t=>T()),onBlur:ne,onKeydown:se},null,40,De),[[G,n(r).name]]),n(m)?(a(),l("ul",Te,[n(C)?(a(),l("li",Be,s[8]||(s[8]=[o("span",{class:"loading loading-spinner loading-sm"},null,-1),H(" Ładowanie… ",-1)]))):n(i).length>0?(a(!0),l(v,{key:1},h(n(i),(t,d)=>(a(),l("li",{id:`suggestion-${d}`,key:t.id||t.name+d,role:"option",class:N(["inline-flex flex-row justify-between items-center",{active:d===n(u)}]),"aria-selected":d===n(u),onClick:P=>O(t),onMouseenter:P=>u.value=d,onMousedown:s[2]||(s[2]=I(()=>{},["prevent"]))},[o("span",null,c(t.name),1),o("span",Ie,c(t.unit||"szt."),1)],42,Ee))),128)):!n(C)&&n(i).length===0?(a(),l("li",Ue,s[9]||(s[9]=[o("span",{class:"opacity-60"},"Brak sugestii",-1)]))):w("",!0)])):w("",!0)]),U(o("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>n(r).quantity=t),class:"input input-ghost",min:"1",required:"",type:"number"},null,512),[[G,n(r).quantity]]),U(o("select",{"onUpdate:modelValue":s[4]||(s[4]=t=>n(r).unit=t),class:"select select-ghost col-span-2 w-full"},[s[10]||(s[10]=o("option",{disabled:"",selected:""},"Wybierz jednostkę",-1)),(a(!0),l(v,null,h(n(Z),t=>(a(),l("option",{key:t.name,value:t},c(t.name),9,ze))),128))],512),[[ve,n(r).unit]]),o("div",Ne,[o("button",{type:"button",class:"btn btn-ghost w-full justify-between",onClick:s[5]||(s[5]=t=>b.value=!n(b)),onBlur:s[6]||(s[6]=t=>b.value=!1)},[n(_)?(a(),l("div",je,[o("span",{class:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white shadow-sm",style:z({backgroundColor:`#${n(_).color}`})},c(E(n(_).name)),5),o("span",null,c(n(_).name),1)])):(a(),l("span",qe,"Wybierz kategorię")),S(g,{name:"mdi:chevron-down",class:"ml-auto"})],32),n(b)?(a(),l("ul",Me,[n(ae)==="pending"?(a(),l("li",Ve,s[11]||(s[11]=[o("span",{class:"loading loading-spinner loading-sm"},null,-1),H(" Ładowanie… ",-1)]))):w("",!0),(a(!0),l(v,null,h(n(B),t=>(a(),l("li",{key:t.id,role:"option",class:N([{active:n(r).categoryId===t.id},"inline-flex flex-row w-full items-center gap-3 px-3 py-2 rounded-lg cursor-pointer hover:bg-base-200"]),"aria-selected":n(r).categoryId===t.id,onMousedown:s[7]||(s[7]=I(()=>{},["prevent"])),onClick:d=>le(t)},[o("span",{class:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white shadow-sm",style:z({backgroundColor:`#${t.color}`})},c(E(t.name)),5),o("span",null,c(t.name),1)],42,Oe))),128))])):w("",!0)])],32)]),n(F).length?(a(!0),l(v,{key:0},h(n(F),t=>(a(),l("li",{key:t.category.id,class:"category-list"},[o("span",Fe,[o("span",{class:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white shadow-sm",style:z({backgroundColor:`#${t.category.color}`})},c(E(t.category.name)),5),o("span",null,c(t.category.name),1)]),o("ul",null,[t.products?.length?(a(!0),l(v,{key:0},h(t.products,d=>(a(),l("li",{key:d.id,class:N([{"line-through":d.inCart},"list-row"]),onClick:P=>re(d.id)},[o("span",Re,c(d.name),1),o("span",null,c(d.quantity)+" "+c(d.unit),1)],10,Pe))),128)):(a(),l("li",Je,"Brak produktów w kategorii"))])]))),128)):(a(),l("li",Ke,"Brak produktów na liście"))]),n(V).length?(a(),l("div",Ge,[(a(!0),l(v,null,h(n(V),t=>(a(),l("span",He,c(t),1))),256))])):w("",!0)])}}});export{tt as default};

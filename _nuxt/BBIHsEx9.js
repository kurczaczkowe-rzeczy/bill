import{e as b,h as O,f as j,I as G,D as S,J as B,K as M,r as I,L as N,A as Q,M as W,N as q,p as U,O as x,P as X,i as Y,Q as Z,R as $}from"./BQU3Vh94.js";import{ShoppingListClient as K,ProductClient as k,CategoryClient as ee}from"./D3ioxxVQ.js";const ae={trailing:!0};function te(e,a=25,t={}){if(t={...ae,...t},!Number.isFinite(a))throw new TypeError("Expected `wait` to be a finite number");let c,r,o=[],s,y;const d=(h,u)=>(s=ne(e,h,u),s.finally(()=>{if(s=null,t.trailing&&y&&!r){const n=d(h,y);return y=null,n}}),s);return function(...h){return s?(t.trailing&&(y=h),s):new Promise(u=>{const n=!r&&t.leading;clearTimeout(r),r=setTimeout(()=>{r=null;const i=t.leading?c:d(this,h);for(const f of o)f(i);o=[]},a),n?(c=d(this,h),u(c)):o.push(u)})}}async function ne(e,a,t){return await e.apply(a,t)}function ve(...e){const a=typeof e[e.length-1]=="string"?e.pop():void 0;se(e[0],e[1])&&e.unshift(a);let[t,c,r={}]=e;const o=b(()=>O(t));if(typeof o.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof c!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const s=j();r.server??=!0,r.default??=ie,r.getCachedData??=V,r.lazy??=!1,r.immediate??=!0,r.deep??=G.deep,r.dedupe??="cancel",r._functionName,s._asyncData[o.value];const y={cause:"initial",dedupe:r.dedupe};s._asyncData[o.value]?._init||(y.cachedData=r.getCachedData(o.value,s,{cause:"initial"}),s._asyncData[o.value]=L(s,o.value,c,r,y.cachedData));const d=s._asyncData[o.value];d._deps++;const h=()=>s._asyncData[o.value].execute(y),u=r.server!==!1&&s.payload.serverRendered;{let f=function(v){const D=s._asyncData[v];D?._deps&&(D._deps--,D._deps===0&&D?._off())};const l=x();if(l&&u&&r.immediate&&!l.sp&&(l.sp=[]),l&&!l._nuxtOnBeforeMountCbs){l._nuxtOnBeforeMountCbs=[];const v=l._nuxtOnBeforeMountCbs;X(()=>{v.forEach(D=>{D()}),v.splice(0,v.length)}),Y(()=>v.splice(0,v.length))}const g=l&&(l._nuxtClientOnly||Z($,!1));u&&s.isHydrating&&(d.error.value||d.data.value!==void 0)?d.status.value=d.error.value?"error":"success":l&&(!g&&s.payload.serverRendered&&s.isHydrating||r.lazy)&&r.immediate?l._nuxtOnBeforeMountCbs.push(h):r.immediate&&d.status.value!=="success"&&h();const _=M(),m=S([o,...r.watch||[]],([v],[D])=>{if((v||D)&&v!==D){const R=s._asyncData[D]?.data.value!==void 0,z=s._asyncDataPromises[D]!==void 0;D&&f(D);const T={cause:"initial",dedupe:r.dedupe};if(!s._asyncData[v]?._init){let C;D&&R?C=s._asyncData[D]?.data.value:(C=r.getCachedData(v,s,{cause:"initial"}),T.cachedData=C),s._asyncData[v]=L(s,v,c,r,C)}s._asyncData[v]._deps++,(r.immediate||R||z)&&s._asyncData[v].execute(T)}else d._execute({cause:"watch",dedupe:r.dedupe})},{flush:"sync"});_&&B(()=>{m(),f(o.value)})}const n={data:E(()=>s._asyncData[o.value]?.data),pending:E(()=>s._asyncData[o.value]?.pending),status:E(()=>s._asyncData[o.value]?.status),error:E(()=>s._asyncData[o.value]?.error),refresh:(...f)=>s._asyncData[o.value].execute(...f),execute:(...f)=>s._asyncData[o.value].execute(...f),clear:()=>J(s,o.value)},i=Promise.resolve(s._asyncDataPromises[o.value]).then(()=>n);return Object.assign(i,n),i}function E(e){return b({get(){return e()?.value},set(a){const t=e();t&&(t.value=a)}})}function se(e,a){return!(typeof e=="string"||typeof e=="object"&&e!==null||typeof e=="function"&&typeof a=="function")}function _e(e){const a=j();if(e in a.payload.data||(a.payload.data[e]=void 0),a._asyncData[e]){const t=a._asyncData[e];t._deps++,M()&&B(()=>{t._deps--,t._deps===0&&t?._off()})}return{data:b({get(){return a._asyncData[e]?.data.value??a.payload.data[e]},set(t){a._asyncData[e]?a._asyncData[e].data.value=t:a.payload.data[e]=t}})}}function J(e,a){a in e.payload.data&&(e.payload.data[a]=void 0),a in e.payload._errors&&(e.payload._errors[a]=void 0),e._asyncData[a]&&(e._asyncData[a].data.value=U(e._asyncData[a]._default()),e._asyncData[a].error.value=void 0,e._asyncData[a].status.value="idle"),a in e._asyncDataPromises&&(e._asyncDataPromises[a]&&(e._asyncDataPromises[a].cancelled=!0),e._asyncDataPromises[a]=void 0)}function re(e,a){const t={};for(const c of a)t[c]=e[c];return t}function L(e,a,t,c,r){e.payload._errors[a]??=void 0;const o=c.getCachedData!==V,s=t,y=c.deep?I:N,d=r!==void 0,h=e.hook("app:data:refresh",async n=>{(!n||n.includes(a))&&await u.execute({cause:"refresh:hook"})}),u={data:y(d?r:c.default()),pending:b(()=>u.status.value==="pending"),error:Q(e.payload._errors,a),status:N("idle"),execute:(...n)=>{const[i,f=void 0]=n,l=i&&f===void 0&&typeof i=="object"?i:{};if(e._asyncDataPromises[a]){if((l.dedupe??c.dedupe)==="defer")return e._asyncDataPromises[a];e._asyncDataPromises[a].cancelled=!0}{const _="cachedData"in l?l.cachedData:c.getCachedData(a,e,{cause:l.cause??"refresh:manual"});if(_!==void 0)return e.payload.data[a]=u.data.value=_,u.error.value=void 0,u.status.value="success",Promise.resolve(_)}u.status.value="pending";const g=new Promise((_,m)=>{try{_(s(e))}catch(v){m(v)}}).then(async _=>{if(g.cancelled)return e._asyncDataPromises[a];let m=_;c.transform&&(m=await c.transform(_)),c.pick&&(m=re(m,c.pick)),e.payload.data[a]=m,u.data.value=m,u.error.value=void 0,u.status.value="success"}).catch(_=>{if(g.cancelled)return e._asyncDataPromises[a];u.error.value=q(_),u.data.value=U(c.default()),u.status.value="error"}).finally(()=>{g.cancelled||delete e._asyncDataPromises[a]});return e._asyncDataPromises[a]=g,e._asyncDataPromises[a]},_execute:te((...n)=>u.execute(...n),0,{leading:!0}),_default:c.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{h(),e._asyncData[a]?._init&&(e._asyncData[a]._init=!1),o||W(()=>{e._asyncData[a]?._init||(J(e,a),u.execute=()=>Promise.resolve())})}};return u}const ie=()=>{},V=(e,a,t)=>{if(a.isHydrating)return a.payload.data[e];if(t.cause!=="refresh:manual"&&t.cause!=="refresh:hook")return a.static.data[e]},p=e=>e==null;function De(e){const a=I([]),t=I(new Map);function c(n,i){if(t.value.has(n)){t.value.get(n).push(i);return}t.value.set(n,[i])}function r(n,i){if(!t.value.has(n))return;const f=t.value.get(n)?.filter(l=>l!==i);if(f.length===0){t.value.delete(n);return}t.value.set(n,f)}function o(n){const i=t.value.values();let f=i.next().value;for(;f!==void 0;){if(f.includes(n))return!0;f=i.next().value}return!1}function s(n,i){return!t.value.has(n)&&o("insert")?!0:t.value.has(n)?t.value.get(n).includes(i):!1}function y(n){const i=d(n);return{item:a.value?.[i],index:i}}function d(n){return a.value?.findIndex(i=>i.id===n)??-1}function h(n,i,f){if(p(n))throw new Error("Invalid product");const l=d(n.id),g=!p(i)&&i>-1?i:l;if(g===-1)return a.value.push(n)-1;const _=l>-1||f?1:0,m=_>0?{...a.value[l],...n}:n;return a.value.splice(g,_,m),g}function u(n){const i=d(n);i!==-1&&a.value.splice(i,1)}return S(e,n=>{const i=O(n);i&&(a.value=i)}),{listToSync:a,getItem:y,getItemIndex:d,upsertItem:h,deleteItem:u,blockAction:c,releaseAction:r,isActionBlocked:s}}const he=new K,ye=new k,me=new ee,P={UPDATE:"update",INSERT:"insert",DELETE:"delete"};function ge(e){if(!p(e.record)&&p(e.oldRecord))return P.INSERT;if(!p(e.record)&&!p(e.oldRecord))return P.UPDATE;if(p(e.record)&&!p(e.oldRecord))return P.DELETE;throw new Error("Unknown channel action")}function F(e){if(e==null)throw new Error("value is undefined or null")}function ce(e){if(F(e),H(e))return e.toArray();throw new Error("value is not a KtList type")}function H(e){return e&&typeof e=="object"&&"toArray"in e&&e.toArray}function oe(e){if(F(e),A(e))return e.valueOf();throw new Error("value is not a Long type")}function A(e){return e&&typeof e=="object"&&"low_1"in e&&"high_1"in e}function w(e){if(e===null||typeof e!="object")return e;if("toJs"in e&&typeof e.toJs=="function")return w(e.toJs());if(H(e))return ce(e).map(c=>w(c));if(A(e))return oe(e);if(Array.isArray(e))return e.map(t=>w(t));if(e instanceof Date||e instanceof RegExp||e instanceof Map||e instanceof Set||e instanceof ArrayBuffer||ArrayBuffer.isView(e))return e;const a=e;for(const t of Object.keys(a)){const c=a[t];a[t]=w(c)}return a}function ue(e){if("error"in e)throw new Error(e)}function le(e){if(!("result"in e))throw new Error("Unsupported response type: "+e.constructor.name);return w(e.result)}function pe(e){return ue(e),le(e)}export{De as a,_e as b,me as c,ge as g,ue as h,w as k,ye as p,pe as r,he as s,ve as u};
